{% load static %}
{% load custom_filters %}
{% include 'util/dashboard_user/head.html' %}


  <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body">

            <div class="row page-titles mx-0">
                <div class="col p-md-0">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="javascript:void(0)">Dashboard</a></li>
                        <li class="breadcrumb-item active"><a href="javascript:void(0)">Home</a></li>
                    </ol>
                </div>
            </div>
            <!-- row -->

            <div class="container-fluid">
                 <div class="row justify-content-center">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="form-validation">

                                    <form 
                                    enctype="multipart/form-data" 
                                    class="form-valide" action="" method="post">{% csrf_token %}
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-username">Foto Formal<span class="text-danger"> *</span>
                                            </label>
                                            <div class="col-lg-6">
                                                {% if profile.photo_formal %}
                                                <img 
                                                src="{% url 'pelamar:photo_pelamar' file=profile.photo_formal %}" id="img_photo" height="150" style="cursor:pointer;">
                                                {% else %}
                                                <img style="cursor:pointer;" id="img_photo" height="150" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSteItzPyeDKBxyWiOA8xrPZXIlxOYv1b1VVg&s">
                                                {% endif %}
                                                <input
                                                {% if profile.file_photo %}
                                                value="{{profile.file_photo}}"
                                                {% endif %} 
                                                accept="image/jpeg,image/jpg,image/png" 
                                                name="{{form.file_photo.name}}" type="file" class="d-none" id="photo-formal" 
                                                >
                                            </div>

                                            <script>
                                             let phto = document.getElementById("img_photo")   
                                             let input = document.getElementById('photo-formal')

                                             phto.addEventListener("click",(e) => {
                                                input.click()
                                             })

                                             input.addEventListener("change",(e) => {
                                                phto.src= URL.createObjectURL(e.target.files[0])
                                             })
                                            </script>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-username">Nama Lengkap <span class="text-danger">*</span>
                                            </label>
                                            <div class="col-lg-6">
                                                <input
                                                {% if profile.complete_name %}
                                                value="{{profile.complete_name}}"
                                                {% endif %}  
                                                name="{{form.complete_name.name}}" type="text" class="form-control" id="val-username" placeholder="Enter a username..">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-email">Email <span class="text-danger">*</span>
                                            </label>
                                            <div class="col-lg-6">
                                                <input 
                                                {% if profile.email %}
                                                value="{{profile.email}}"
                                                {% endif %}
                                                value="{{profile.email}}" name="{{form.email.name}}" type="email" class="form-control" id="val-email" placeholder="Your valid email..">
                                            </div>
                                        </div>
                                         <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-email">Telepon <span class="text-danger">*</span>
                                            </label>
                                            <div class="col-lg-6">
                                                <input 
                                                {% if profile.no_telp %}
                                                value="{{profile.no_telp}}"
                                                {% endif %}
                                                value="{{profile.no_telp}}" oninput="limitDigits(this)" name="{{form.no_telp.name}}" type="number" class="form-control" id="val-email" placeholder="Nomor Telepon">
                                            </div>
                                        </div>
                                        <script>
                                            function limitDigits(input) {
                                                const maxLength = 12;
                                                if (input.value.length > maxLength) {
                                                  input.value = input.value.slice(0, maxLength);
                                                }
                                            }  
                                        </script>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-password">Tanggal Lahir <span class="text-danger">*</span>
                                            </label>
                                            <div class="col-lg-6">
                                                <input 

                                                value="{{profile.date_birth |date:'U' | inputDate}}" name="{{form.date_birth.name}}" type="date" class="form-control" id="val-password"  placeholder="Choose a safe one..">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-confirm-password">Pendidikan Terakhir <span class="text-danger">*</span>
                                            </label>
                                              <div class="col-auto my-1">
                                                <select name="{{form.last_education.name}}" class="custom-select mr-sm-2" id="inlineFormCustomSelect">
                                                   <option value="" disabled selected>
                                                    Pilih Pendidikan Terakhir</option>
                                                    {% for id,name in form.last_education.field.choices %}
                                                     {% if forloop.counter > 1 %}
                                                        <option 
                                                        {% if profile.last_education.id == id %}
                                                        selected ="selected"
                                                        {% endif %}
                                                        value="{{ id }}">{{ name }}</option>
                                                     {% endif %}         
                                                    {% endfor %}
                                                </select>
                                                
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-suggestions">Jurusan <span class="text-danger">*</span>
                                            </label>
                                            <div class="col-lg-6">
                                                <input 
                                                {% if profile.jurusan %}
                                                value="{{profile.jurusan}}"
                                                {% endif %}
                                                placeholder="Jurusan" 
                                                name="{{form.jurusan.name}}" type="text" class="form-control" >
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-suggestions">Ceritakan Diri Anda <span class="text-danger">*</span>
                                            </label>
                                            <div class="col-lg-6">
                                                <input
                                                {% if profile.about %}
                                                value="{{profile.about}}"
                                                {% endif %}
                                                 placeholder="Tentang Diri Anda" name="{{form.about.name}}" class="form-control"  />
                                                
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-currency">CV <span class="text-danger">*</span>
                                            </label>
                                            <div class="col-lg-6">
                                                <span>*pdf</span>
                                                {% if profile.file_cv %}
                                                <a 
                                                target="_blank" 
                                                href="{% url 'pelamar:cv_pelamar' file=profile.file_cv %}">Your File</a>
                                                {% endif %}
                                                <input accept="application/pdf" placeholder="*pdf" 
                                                name="{{form.files_cv.name}}" type="file" class="form-control" id="val-currency"  placeholder="$21.60">
                                                <span><a href="#">Open File</a></span>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-website">Website 
                                            </label>
                                            <div class="col-lg-6">
                                                <input
                                                {% if profile.website %}
                                                value="{{profile.website}}"
                                                {% endif %}
                                                  name="{{form.website.name}}" type="text" class="form-control" id="val-website" placeholder="https://example.com">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-website">Linkedln 
                                            </label>
                                            <div class="col-lg-6">
                                                <input 
                                                {% if profile.linkedln %}
                                                value="{{profile.linkedln}}"
                                                {% endif %}
                                                name="{{form.linkedln.name}}" type="text" class="form-control" id="val-website"  placeholder="https://linkedln.com/in/username">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label class="col-lg-4 col-form-label" for="val-skill">Skill
                                            </label>
                                            <div class="col-lg-6" id="tags-input" style="padding: 15px; position: relative;">
                                            <div class="tags-wrapper" style="border: 1px solid #ccc; border-radius: 4px; padding: 5px; display: flex; flex-wrap: wrap; gap: 5px;">
                                                <span style="display: inline-flex; align-items: center; background: rgb(0, 173, 255); color: white; padding: 5px; border-radius: 3px; margin-right: 5px;">My Skiils</span>
                                                <input type="text" style="flex: 1; border: none; outline: none; padding: 5px;" class="form-control" id="tags"  placeholder="Skills Anda (Enter)">
                                            </div>
                                            <input type="hidden" value="{{profile.complete_name}}" class="form-control" id="tags-value" name="{{form.skills.name}}" />
                                        </div>
                                        <script>
                                        document.addEventListener('DOMContentLoaded', function () {
                                            const tagsWrapper = document.querySelector('.tags-wrapper');
                                            const tagsValue = document.getElementById('tags-value');
                                            const input = document.getElementById('tags');
                                            const dataSkiils = "{{profile.skills}}"
                                            console.log(dataSkiils)
                                            input.addEventListener('keydown', function (e) {
                                                if (e.key === 'Enter' && input.value.trim() !== '') {
                                                    e.preventDefault();

                                                    const tag = document.createElement('span');
                                                    tag.classList.add('label', 'label-info');
                                                    tag.style.display = 'inline-flex';
                                                    tag.style.alignItems = 'center';
                                                    tag.style.background = '#007bff';
                                                    tag.style.color = 'white';
                                                    tag.style.padding = '5px 5px';
                                                    tag.style.borderRadius = '3px';
                                                    tag.style.marginRight = '5px';

                                                    tag.textContent = input.value.trim();

                                                    const removeSpan = document.createElement('span');
                                                    removeSpan.textContent = 'X';
                                                    removeSpan.style.cursor = 'pointer';
                                                    removeSpan.style.color = 'white';
                                                    removeSpan.style.marginLeft = '8px';
                                                    removeSpan.style.fontWeight = 'bold';

                                                    removeSpan.addEventListener('click', function () {
                                                        tag.remove();
                                                        updateTagsValue();
                                                    });

                                                    tag.appendChild(removeSpan);
                                                    tagsWrapper.insertBefore(tag, input);
                                                    input.value = ''; // Clear the input field
                                                    updateTagsValue();
                                                }
                                            });

                                            function updateTagsValue() {
                                                const tags = [];
                                                tagsWrapper.querySelectorAll('span.label-info').forEach(tag => {
                                                    tags.push(tag.textContent.replace('X', '').trim());
                                                });
                                                tagsValue.value = tags.join(',');
                                            }
                                        });
                                        </script>
                                        </div>                                        
                                       
                                       
                                        <div class="form-group row">
                                            <div class="col-lg-8 ml-auto">
                                                <button type="submit" class="btn btn-primary">Submit</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- #/ container -->
        </div>
        <!--**********************************
            Content body end
        ***********************************-->


{% include 'util/dashboard_user/foot.html' %}